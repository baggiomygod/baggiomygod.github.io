---
layout:     post
title:      闭包
subtitle:   img javascript in
date:       2019-6-2
author:     wengfan
header-img: img/post-bg-keybord.jpg
catalog: true
tags:
    - javascript
    - 笔记
---

# 闭包
闭包是javascript语言的一个难点，也是它的特色，很多高级应用都依靠闭包实现

# 概念
首先了解一个javascript变量的作用于，无非就是两种：全局变量和局部变量。javascript语言的特殊之处，就在于函数内部可以直接读取全局变量，就在于函数内部可以直接读取全局变量。另一方面，在函数外部是无法读取函数内部的局部变量的。但是通过闭包，可以在函数外部访问内部的变量。

本质上，闭包就是讲函数内部和外部链接在一起的一座桥梁

# 用途

闭包允许将函数与其所操作的某些数据（环境）关联起来。这显然类似于面向对象编程。在面向对象编程中，对象允许我们将某些数据（对象的属性）与一个或多个方法相关联。因而，一般来说，可以使用只有一个方法的对象的地方，都可以使用闭包。

## 使变量的值始终保存在内存中
```
    function f1() {
        var n = 999;
        function f2() {
            alert(n++)
        }
        return f2
    }
    var result = f1()
    result() // 999
    result() // 1000
```
这里我们在外部调用result函数，可以不断增加内部n的值，实际上函数f1中的局部变量n一直保存在内存中，并没有在f1调用后被销毁。

**原因：**f1是f2的福函数，而f2被赋值给了一个全局变量，这导致f2始终保存在内存中，而f2的存在依赖于f1，因此f1也会始终在内存中，不会再调用结束后被垃圾回收机制回收。


# 使用闭包模拟私有方法
javascript并不提供原生的支持，但是可以使用闭包模拟私有方法，私有方法不仅仅有利于限制对代码的访问，还提供了管理全局命名空间的强大能力，避免非核心代码的方法弄乱了代码的公共接口部分
```
    var Counter = (function() {
        // 私有方法和属性不能直接被访问
        var privateCounter = 0
        function changeBy(val) {
            privateCounter += val
        }

        // 外部只能通过暴露出去的方法，在修改值-
        return {
            increment: function() {
                changeBy(1)
            },
            value: function () {
                return privateCounter
            }
        }
    })
```

# 在循环中使用闭包
（未完）
# 使用闭包的注意点
- 由于闭包会使得函数中的比变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页性能问题。
> 解决方法，退出函数前，将不使用的局部变量全部删除

- 闭包会在父函数外部，改变父函数内部的变量值。所以，如果你把父函数当做对象使用，把闭包当做它的公用方法，把内部变量当做它的私有属性，这时一定要小心，不要随便修改父函数内部变量的值。